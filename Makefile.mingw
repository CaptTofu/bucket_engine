# Linux, cross compile
#CC := i386-mingw32msvc-gcc
# Windows
CC := mingw32-gcc

testapp_obj := testapp.exe

all: ${testapp_obj}

win32_objs := win32/defs.o
win32_objs += win32/win32.o
win32_objs += win32/dlfcn.o
# win32_objs += win32/ntservice.o

testapp_objs := testapp.o
testapp_objs += bucket_engine.o genhash.o config_parser.o mock_engine.o util.o
testapp_objs += ${win32_objs}

testapp_cflags := -std=gnu99 -O2
testapp_cflags += -Imemcached/include
testapp_cflags += -Iwin32 -Iwin32/include
# testapp_cflags += -fno-strict-aliasing
# testapp_cflags += -Wall -Werror -Wstrict-prototypes -Wmissing-prototypes
# testapp_cflags += -Wmissing-declarations -Wredundant-decls
# testapp_cflags += -DHAVE_CONFIG_H

testapp_ldflags := -lwsock32 -lws2_32
testapp_ldflags += -lpthread
# testapp_ldflags += -levent
# testapp_ldflags += -L../testapp_win32_deps

%.o: %.c
	${CC} ${testapp_cflags} -MD -c $< -o $@

-include ${testapp_objs:.o=.d}

${testapp_obj}: ${testapp_objs}
	${CC} -o ${testapp_obj} ${testapp_objs} ${testapp_ldflags}

clean:
	rm -f ${testapp_objs:.o=.d} ${testapp_objs} ${testapp_obj}



